<?xml version="1.0" encoding="UTF-8"?>
<data xmlns="ns:workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ns:workflow resource:WorkflowData">

	<documentTypes xmlns="ns:workflow/DocumentType"
		xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
		<documentType>
			<name>ProtocolDocument</name>
			<description>Create a KC Protocol Document</description>
			<label>KC Protocol</label>
			<parent>KC</parent>
			<postProcessorName>org.kuali.rice.kns.workflow.postprocessor.KualiPostProcessor</postProcessorName>
			<superUserWorkgroupName>KC-WKFLW:IRBAdmin</superUserWorkgroupName>
			<blanketApproveWorkgroupName>KC-WKFLW:IRBAdmin</blanketApproveWorkgroupName>
			<defaultExceptionWorkgroupName>KC-WKFLW:IRBAdmin</defaultExceptionWorkgroupName>
			<docHandler>${kuali.docHandler.url.prefix}/protocolProtocol.do?methodToCall=docHandler</docHandler>
			<active>true</active>
			<policies>
				<policy>
					<name>DEFAULT_APPROVE</name>
					<value>false</value>
					<!--
						this should be false in a production scenario
					-->
				</policy>
				<policy>
                    <name>LOOK_FUTURE</name>
                    <value>true</value>
                </policy>
			</policies>
			<routePaths>
				<routePath>
					<start name="Initiated" nextNode="AssignedToAgenda" />
                    <requests name="AssignedToAgenda" nextNode="IRBReview" />
					<requests name="IRBReview" />
				</routePath>
			</routePaths>
			<routeNodes>
				<start name="Initiated">
					<activationType>S</activationType>
				</start>
                <role name="AssignedToAgenda">
					<qualifierResolverClass>org.kuali.rice.kew.role.NullQualifierResolver</qualifierResolverClass>
                    <activationType>S</activationType>
					<ruleTemplate>AssignedToAgenda</ruleTemplate>
	            </role>                
                <role name="IRBReview">
					<qualifierResolverClass>org.kuali.rice.kew.role.NullQualifierResolver</qualifierResolverClass>
                    <activationType>S</activationType>
					<ruleTemplate>IRBReview</ruleTemplate>
	            </role>                     
			</routeNodes>
		</documentType>
	</documentTypes>

	<ruleAttributes xmlns="ns:workflow/RuleAttribute"
		xsi:schemaLocation="ns:workflow/RuleAttribute resource:RuleAttribute">
	
	    <ruleAttribute>
            <name>ProtocolWorkflowTypeAttribute</name>
            <className>org.kuali.rice.kew.rule.xmlrouting.StandardGenericXMLRuleAttribute</className>
            <label>ProtocolWorkflowTypeAttribute</label>
            <description>ProtocolWorkflowTypeAttribute</description>
            <type>RuleXmlAttribute</type>
            <routingConfig>
                <fieldDef name="protocolWorkflowType" title="protocolWorkflowType" workflowType="RULE">
                    <display>
                        <type>text</type>
                    </display>
                    <validation required="false" />
                    <fieldEvaluation>
                        <!-- expectation: this is run and evaluates to true  -->
                        <xpathexpression>
                        wf:xstreamsafe('//document/protocolWorkflowType') = wf:ruledata('protocolWorkflowType')
                        </xpathexpression>
                    </fieldEvaluation>
                </fieldDef>
            </routingConfig>
        </ruleAttribute>
    </ruleAttributes>
    
	<ruleTemplates xmlns="ns:workflow/RuleTemplate" xsi:schemaLocation="ns:workflow/RuleTemplate resource:RuleTemplate">
        <ruleTemplate allowOverwrite="true">
            <name>AssignedToAgenda</name>
            <description>IRB AssignedToAgenda Routing</description>
            <attributes>
                <attribute>
                    <name>ProtocolWorkflowTypeAttribute</name>
                    <required>true</required>
                </attribute>
            </attributes>
        </ruleTemplate>
        <ruleTemplate allowOverwrite="true">
            <name>IRBReview</name>
            <description>IRB IRBReview Routing</description>
            <attributes>
            	<attribute>
                	<name>ProtocolWorkflowTypeAttribute</name>
                    <required>true</required>
                </attribute>
            </attributes>
        </ruleTemplate>
        
	</ruleTemplates>
	
	<rules xmlns="ns:workflow/Rule" xsi:schemaLocation="ns:workflow/Rule resource:Rule">
        <rule>
            <name>AssignedToAgendaRule</name>
            <documentType>ProtocolDocument</documentType>
            <ruleTemplate>AssignedToAgenda</ruleTemplate>
            <description>AssignedToAgenda Routing</description>
            <forceAction>true</forceAction>
            <ruleExtensions>
            <ruleExtension>            
              <attribute>ProtocolWorkflowTypeAttribute</attribute>
              <ruleTemplate>AssignedToAgenda</ruleTemplate>
              <ruleExtensionValues>
                <ruleExtensionValue>
                  <key>protocolWorkflowType</key>
                  <value>Normal</value>
                </ruleExtensionValue>
              </ruleExtensionValues>
              </ruleExtension>            
            </ruleExtensions>
        </rule>
        <rule>
            <name>IRBReview</name>
            <documentType>ProtocolDocument</documentType>
            <ruleTemplate>IRBReview</ruleTemplate>
            <description>IRBReview Routing</description>
            <forceAction>true</forceAction>
            <ruleExtensions>
            <ruleExtension>            
              <attribute>ProtocolWorkflowTypeAttribute</attribute>
              <ruleTemplate>IRBReview</ruleTemplate>
              <ruleExtensionValues>
                <ruleExtensionValue>
                  <key>protocolWorkflowType</key>
                  <value>Normal</value>
                </ruleExtensionValue>
              </ruleExtensionValues>
              </ruleExtension>            
            </ruleExtensions>
        </rule>
    </rules>
</data>