ALTER TABLE BUDGET_RATE_AND_BASE ADD BUDGET_ID NUMBER (12, 0) ;

ALTER TABLE BUDGET_RATE_AND_BASE DROP PRIMARY KEY;

ALTER TABLE BUDGET_RATE_AND_BASE MODIFY PROPOSAL_NUMBER NULL;

ALTER TABLE BUDGET_RATE_AND_BASE MODIFY VERSION_NUMBER NULL;

UPDATE BUDGET_RATE_AND_BASE 
SET BUDGET_ID=(SELECT BUDGET_ID FROM BUDGET 
               WHERE BUDGET.PROPOSAL_NUMBER = BUDGET_RATE_AND_BASE.PROPOSAL_NUMBER
                     AND BUDGET.VERSION_NUMBER = BUDGET_RATE_AND_BASE.VERSION_NUMBER) ;

COMMIT;

ALTER TABLE BUDGET_RATE_AND_BASE 
    ADD CONSTRAINT PK_BUDGET_RATE_AND_BASE 
            PRIMARY KEY (BUDGET_PERIOD_NUMBER, LINE_ITEM_NUMBER, RATE_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE) ;

ALTER TABLE BUDGET_RATE_AND_BASE 
    ADD CONSTRAINT FK1_BUDGET_RATE_AND_BASE 
            FOREIGN KEY (BUDGET_PERIOD_NUMBER, LINE_ITEM_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE) 
                REFERENCES BUDGET_DETAILS_CAL_AMTS;