ALTER TABLE BUDGET_SUB_AWARDS ADD BUDGET_ID NUMBER (12, 0) ;

ALTER TABLE BUDGET_SUB_AWARD_FILES 
    DROP CONSTRAINT KRA_BUDGET_SUB_AWARDS_FK1;

ALTER TABLE BUDGET_SUB_AWARD_ATT 
    DROP CONSTRAINT KRA_BUDGET_SUB_AWARD_ATT_FK1;

ALTER TABLE BUDGET_SUB_AWARDS DROP PRIMARY KEY;

ALTER TABLE BUDGET_SUB_AWARDS MODIFY PROPOSAL_NUMBER NULL;

ALTER TABLE BUDGET_SUB_AWARDS MODIFY VERSION_NUMBER NULL;

UPDATE BUDGET_SUB_AWARDS 
SET BUDGET_ID=(SELECT BUDGET_ID FROM BUDGET 
               WHERE BUDGET.PROPOSAL_NUMBER = BUDGET_SUB_AWARDS.PROPOSAL_NUMBER
                     AND BUDGET.VERSION_NUMBER = BUDGET_SUB_AWARDS.VERSION_NUMBER) ;

COMMIT;

ALTER TABLE BUDGET_SUB_AWARDS 
    ADD CONSTRAINT PK_BUDGET_SUB_AWARDS 
            PRIMARY KEY (BUDGET_ID, SUB_AWARD_NUMBER) ;