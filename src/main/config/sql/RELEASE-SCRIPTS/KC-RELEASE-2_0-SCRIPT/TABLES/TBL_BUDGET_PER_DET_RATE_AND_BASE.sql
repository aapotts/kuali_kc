ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE ADD BUDGET_ID NUMBER (12, 0) ;

ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE MODIFY PROPOSAL_NUMBER NULL;

ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE MODIFY VERSION_NUMBER NULL;

CREATE TABLE TEMP_BPDRAB AS SELECT *FROM BUDGET_PER_DET_RATE_AND_BASE;

TRUNCATE TABLE BUDGET_PER_DET_RATE_AND_BASE;

ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE MODIFY RATE_CLASS_CODE VARCHAR2 (3) ;

ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE MODIFY RATE_TYPE_CODE VARCHAR2 (3) ;

INSERT INTO BUDGET_PER_DET_RATE_AND_BASE (BUDGET_ID, BUDGET_PERIOD_NUMBER, LINE_ITEM_NUMBER, PERSON_NUMBER, RATE_NUMBER, PROPOSAL_NUMBER, VERSION_NUMBER, BUDGET_PERIOD, PERSON_ID, START_DATE, END_DATE, RATE_CLASS_CODE, RATE_TYPE_CODE, ON_OFF_CAMPUS_FLAG, APPLIED_RATE, SALARY_REQUESTED, BASE_COST_SHARING, CALCULATED_COST, CALCULATED_COST_SHARING, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID, UNDERRECOVERY_AMOUNT) SELECT B.BUDGET_ID, T.BUDGET_PERIOD_NUMBER, T.LINE_ITEM_NUMBER, T.PERSON_NUMBER, T.RATE_NUMBER, T.PROPOSAL_NUMBER, T.VERSION_NUMBER, T.BUDGET_PERIOD, T.PERSON_ID, T.START_DATE, T.END_DATE, T.RATE_CLASS_CODE, T.RATE_TYPE_CODE, T.ON_OFF_CAMPUS_FLAG, T.APPLIED_RATE, T.SALARY_REQUESTED, T.BASE_COST_SHARING, T.CALCULATED_COST, T.CALCULATED_COST_SHARING, T.UPDATE_TIMESTAMP, T.UPDATE_USER, T.VER_NBR, T.OBJ_ID, T.UNDERRECOVERY_AMOUNT FROM TEMP_BPDRAB T, BUDGET B WHERE T.PROPOSAL_NUMBER = B.PROPOSAL_NUMBER AND T.VERSION_NUMBER = B.VERSION_NUMBER;

COMMIT;

DROP TABLE TEMP_BPDRAB;

ALTER TABLE BUDGET_PER_DET_RATE_AND_BASE 
    ADD CONSTRAINT FK1_BGT_PER_DET_RATE_AND_BASE 
            FOREIGN KEY (BUDGET_PERIOD_NUMBER, LINE_ITEM_NUMBER, PERSON_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE) 
                REFERENCES BUDGET_PERSONNEL_CAL_AMTS;