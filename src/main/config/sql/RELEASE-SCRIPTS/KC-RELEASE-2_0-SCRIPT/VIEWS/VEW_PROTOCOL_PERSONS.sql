CREATE OR REPLACE VIEW OSP$PROTOCOL_INVESTIGATORS(PROTOCOL_NUMBER,SEQUENCE_NUMBER,PERSON_ID,PERSON_NAME,NON_EMPLOYEE_FLAG,PRINCIPAL_INVESTIGATOR_FLAG,AFFILIATION_TYPE_CODE,UPDATE_TIMESTAMP,UPDATE_USER) AS 
SELECT PROTOCOL_NUMBER,
       SEQUENCE_NUMBER,
       CAST (DECODE (TO_CHAR (ROLODEX_ID) , NULL, PERSON_ID, TO_CHAR (ROLODEX_ID) ) AS VARCHAR2 (10) ) PERSON_ID,
       PERSON_NAME,
       DECODE (PERSON_ID, NULL, 'Y', 'N') NON_EMPLOYEE_FLAG,
       DECODE (PROTOCOL_PERSON_ROLE_ID, 'PI', 'Y', 'N') PRINCIPAL_INVESTIGATOR_FLAG,
       AFFILIATION_TYPE_CODE,
       UPDATE_TIMESTAMP,
       UPDATE_USER
FROM   PROTOCOL_PERSONS
WHERE  PROTOCOL_PERSON_ROLE_ID IN('PI', 'COI') ;

CREATE OR REPLACE VIEW OSP$PROTOCOL_KEY_PERSONS(PROTOCOL_NUMBER,SEQUENCE_NUMBER,PERSON_ID,PERSON_NAME,PERSON_ROLE,NON_EMPLOYEE_FLAG,AFFILIATION_TYPE_CODE,UPDATE_TIMESTAMP,UPDATE_USER) AS 
SELECT PROTOCOL_NUMBER,
       SEQUENCE_NUMBER,
       DECODE (PERSON_ID, NULL, TO_CHAR (ROLODEX_ID) , PERSON_ID) PERSON_ID,
       PERSON_NAME,
       B.DESCRIPTION PERSON_ROLE,
       DECODE (PERSON_ID, NULL, 'N', 'Y') NON_EMPLOYEE_FLAG,
       AFFILIATION_TYPE_CODE,
       A.UPDATE_TIMESTAMP UPDATE_TIMESTAMP,
       A.UPDATE_USER UPDATE_USER
FROM   PROTOCOL_PERSONS A,
       PROTOCOL_PERSON_ROLES B
WHERE  B.PROTOCOL_PERSON_ROLE_ID = A.PROTOCOL_PERSON_ROLE_ID 
       AND A.PROTOCOL_PERSON_ROLE_ID NOT IN('PI', 'COI') ;