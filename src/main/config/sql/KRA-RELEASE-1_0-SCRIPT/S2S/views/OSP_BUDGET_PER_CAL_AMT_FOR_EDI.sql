
  CREATE OR REPLACE 
	VIEW OSP$BUDGET_PER_CAL_AMT_FOR_EDI (PROPOSAL_NUMBER, BUDGET_PERIOD, LINE_ITEM_NUMBER, PERSON_NUMBER, RATE_NUMBER, RATE_CLASS_CODE, RATE_TYPE_CODE, APPLIED_RATE, CALCULATED_COST, CALCULATED_COST_SHARING, APPLY_RATE_FLAG, UPDATE_TIMESTAMP, UPDATE_USER) AS 
SELECT 
  A.PROPOSAL_NUMBER PROPOSAL_NUMBER, 
  A.BUDGET_PERIOD BUDGET_PERIOD , 
  A.LINE_ITEM_NUMBER LINE_ITEM_NUMBER, 
  A.PERSON_NUMBER PERSON_NUMBER,
  A.RATE_NUMBER RATE_NUMBER,  
  A.RATE_CLASS_CODE RATE_CLASS_CODE, 
  A.RATE_TYPE_CODE RATE_TYPE_CODE,
  A.APPLIED_RATE APPLIED_RATE,  
  A.CALCULATED_COST CALCULATED_COST,
  A.CALCULATED_COST_SHARING CALCULATED_COST_SHARING,  
  B.APPLY_RATE_FLAG APPLY_RATE_FLAG,  
  A.UPDATE_TIMESTAMP UPDATE_TIMESTAMP, 
  A.UPDATE_USER UPDATE_USER
FROM (SELECT
	  PROPOSAL_NUMBER, 
	  VERSION_NUMBER,
	  BUDGET_PERIOD , 
	  LINE_ITEM_NUMBER, 
	  PERSON_NUMBER,
	  START_DATE,
	  END_DATE,
      RATE_NUMBER RATE_NUMBER,  
	  RATE_CLASS_CODE,
	  RATE_TYPE_CODE,
  	  APPLIED_RATE APPLIED_RATE,  
  	  CALCULATED_COST CALCULATED_COST,
  	  CALCULATED_COST_SHARING CALCULATED_COST_SHARING,  
  	  UPDATE_TIMESTAMP UPDATE_TIMESTAMP, 
  	  UPDATE_USER UPDATE_USER
	FROM BUDGET_PER_DET_RATE_AND_BASE X 
MINUS
SELECT
	  PROPOSAL_NUMBER, 
	  VERSION_NUMBER,
	  BUDGET_PERIOD , 
	  LINE_ITEM_NUMBER,
	  PERSON_NUMBER,
	  START_DATE,
	  END_DATE,
      RATE_NUMBER RATE_NUMBER,  
	  X.RATE_CLASS_CODE,
	  X.RATE_TYPE_CODE,
  	  APPLIED_RATE APPLIED_RATE,  
  	  CALCULATED_COST CALCULATED_COST,
  	  CALCULATED_COST_SHARING CALCULATED_COST_SHARING,  
  	  UPDATE_TIMESTAMP UPDATE_TIMESTAMP, 
  	  UPDATE_USER UPDATE_USER
	FROM BUDGET_PER_DET_RATE_AND_BASE X,	(SELECT RATE_CLASS_CODE, RATE_TYPE_CODE
	FROM VALID_CALC_TYPES WHERE RATE_CLASS_TYPE  IN ('E', 'V')) Y
	WHERE X.rate_class_code = Y.rate_class_code AND X.RATE_TYPE_CODE = Y.RATE_TYPE_CODE)A, BUDGET_PERSONNEL_CAL_AMTS B 
WHERE B.PROPOSAL_NUMBER = A.PROPOSAL_NUMBER AND
B.BUDGET_PERIOD = A.BUDGET_PERIOD AND B.LINE_ITEM_NUMBER = A.LINE_ITEM_NUMBER AND
B.PERSON_NUMBER = A.PERSON_NUMBER AND B.RATE_CLASS_CODE = A.RATE_CLASS_CODE AND
B.RATE_TYPE_CODE = A.RATE_TYPE_CODE; 
